<h2><%= link_to "アンケートサンプル", {action: 'index'}, {style: "text-decoration: none"} %></h2>

<p id="notice"><%= notice %></p>

<div class="enquete_title"><%= @enquete.name %></div>

<%= form_for(:answer, url: {action: 'create'}) do |f| %>
  <% @enquete.questions.sort{|a,b| a.question_number.split(/_/)[1].to_i <=> b.question_number.split(/_/)[1].to_i}.each do |q| %>
    <% n = q.question_number.split(/_/)[1].to_i %>
    <div class="header">質問<%= n %></div>
    <div class="question">
      <% if @err_msg && @err_msg[q.question_number] %>
        <span class="err_msg"><%= @err_msg[q.question_number] %></span>
      <% end %>
      <div class="title"><%= q.body %> <%= %Q!<span class="requires">※必須</span>! if q.required_column %></div>
      <% if q.type == 'text' %>
        <%= f.text_field q.question_number %>
      <% elsif q.type == 'radio' %>
        <% q.choices.each_with_index do |choice, i| %>
          <%= check_box_tag "answer[#{q.question_number}][]", i, false, id: "answer_#{q.question_number}_#{i}" %>
          <label for="answer_<%= q.question_number %>_<%= i %>"><%= choice %></label><br />
        <% end %>
      <% elsif q.type == 'checkbox' %>
        <% q.choices.each_with_index do |choice, i| %>
          <%= f.radio_button q.question_number, i %>
          <label for="answer_<%= q.question_number %>_<%= i %>"><%= choice %></label><br />
        <% end %>
      <% elsif q.type == 'pulldown' %>
        <%
          list = []
          q.choices.each_with_index do |choice, i|
            list << [choice, i]
          end
        %>
        <%= f.select q.question_number, list %>
      <% elsif q.type == 'textarea' %>
        <%= f.text_area q.question_number, size: '40x5' %>
      <% end %>
    </div>
    <div class="clear"></div>
  <% end %>
  <%= f.hidden_field :user_id, value: 1 %>
  <%= f.hidden_field :enquete_id, value: @enquete.id %>
  <div><%= f.submit 'この内容で送信する' %></div>
<% end %>

<%= link_to 'Edit', edit_enquete_path(@enquete) %> |
<%= link_to 'Back', enquetes_path %>
